We now continue with the general case, in which $\varphi(\x,\X)$ is an arbirtary extended quantifier-free $\L$-formula. By using a standard DNF transformation algorithm and considering FO-formulas over $\L$ as literals, we can find formulas $\gamma_i(\x,\X)$ with $i\in\{1,\ldots,\ell\}$ such that
\begin{eqnarray*}
\varphi(\x,\X) &\equiv& \gamma_1(\x,\X) \vee \gamma_2(\x,\X) \vee \dots  \vee \gamma_{\ell}(\x,\X),
\end{eqnarray*}
where, for every $i\in\{1,\ldots,\ell\}$, 
\begin{eqnarray*}
\gamma_i(\x,\X) &=& \left( \bigwedge_{j=1}^{n_i} X_{\lambda_i(j)}(\x_{i,j}) \right) \wedge \gamma^{-}_i(\X,\y_i)  \wedge \delta_i(\x).
\end{eqnarray*}
The function $\lambda_i$ is defined analogously to $\lambda$ of the first part of the proof. The tuple $\x_{i,j}$ has $a_{\lambda_i(j)}$ variables for $j\in\{1,\ldots,n_i\}$, $\y_i$ has $p_i$ variables and are such that $(\x_{i,1},\ldots,\x_{i,n_i},\y_i) = \x.$ The formulas $\gamma^{-}_i(\X,\y_i)$, $\delta_i(\x)$ are defined analogously to $\varphi^{-}(\X,\y)$ and $\beta(\x)\,$\footnote[2]{Note that $\delta_i(\x)$ can include subformulas of the form $(\u = \u)$.} respectively (see \eqref{f1}). Let $g$ be a function that counts the number of possible orders over partitions on a $d$-tuple of variables. Let the formulas $\theta^i(\x)$ for $i\in\{1,\ldots,g(d)\}$ represent each of these orders over $\x$. Note that for every formula $\eta(\x)$,
\begin{eqnarray*}
\exists\x\:\eta(\x) &\equiv& \exists\x(\eta(\x)\wedge\theta^1(\x)) \vee \cdots \vee \exists\x(\eta(\x)\wedge\theta^{g(d)}(\x)).
\end{eqnarray*}
We define the following formulas $\xi_i(\x,\X)$, for $i\in\{1,\ldots,m\}$ where $m = \ell \cdot g(d)$, as follows: 
\begin{eqnarray*}
\xi_1(\x,\X) &=& \gamma_1(\x,\X) \wedge \theta^1(\x), \\
& \vdots & \\
\xi_{g(d)}(\x,\X) &=& \gamma_1(\x,\X) \wedge \theta^{g(d)}(\x), \\
\xi_{g(d)+1}(\x,\X) &=& \gamma_2(\x,\X) \wedge \theta^1(\x), \\
& \vdots & \\
\xi_{2\cdot g(d)}(\x,\X) &=& \gamma_2(\x,\X) \wedge \theta^{g(d)}(\x), \\
& \vdots & \\
\xi_{(\ell-1) g(d)+1}(\x,\X) &=& \gamma_{\ell}(\x,\X) \wedge \theta^1(\x), \\
& \vdots & \\
\xi_{\ell \cdot g(d)}(\x,\X) &=& \gamma_{\ell}(\x,\X) \wedge \theta^{g(d)}(\x).
\end{eqnarray*}
Having every disjunct with a total order allows us to eliminate the ones that are unsatisfiable for every $\L$-structure $\A$, that is, each $i\in\{1,\ldots,m\}$ such that for every assignment $\s$ to $\x,$ $f_{\xi_i(\s,\X)}(\A) = 0,$ for every $\A\in\Truc.$ 
\icristian{
Cuidado! Es indecidible verificar si una formula es no satisfacible. Lo que queremos decir acá es que verificar que $\left( \bigwedge_{i=1}^n X_{\lambda(i)}(\x_i) \right) \wedge \varphi^{-}(\X,\y) \wedge \theta(\x)$ (sin el $\beta$) es decidible. 
}
Let $k$ be the number of disjuncts that are left after eliminating the unsatisfiable disjuncts. We use an injective\footnote[3]{We need this function to be injective because this way we can assure each one of the $k$ satisfiable disjuncts to be represented} function $\rho:\{1,\ldots,k\}\to\{1,\ldots,m\}$ such that $\varphi_i(\x,\X) = \xi_{\rho(i)}(\x,\X)$ is satisfiable, for every $i\in\{1,\ldots,k\}.$

We can conclude that
\begin{eqnarray*}
\varphi(\x,\X) &\equiv& \varphi_1(\x,\X) \vee \varphi_2(\x,\X) \vee \dots  \vee \varphi_k(\x,\X),
\end{eqnarray*}
and for every $i\in\{1,\ldots,k\}$,
\begin{eqnarray*}
\varphi_i(\x,\X) &=& \left( \bigwedge_{j=1}^{n_i} X_{\lambda_i(j)}(\x_{i,j}) \right) \wedge \varphi^{-}_i(\X,\y_i) \wedge \theta_i(\x) \wedge \beta_i(\x),
\end{eqnarray*}
where $n_i$ is the number of times a non-negated variable in $\X$ is referred to, according to the function $\lambda_i:\{1,\ldots,n_i\}\to\{1,\ldots,r\}$, $\y_i$ is a $p_i$-tuple of variables in $\x$, $\varphi_i^{-}(\X,\y_i)$ is a conjunction of negated predicates in $\X$, $\theta_i(\x)$ defines a total order on a partition of $\x$, and $\beta_i(\x)$ is an FO-formula over $\L$ which mentions all variables in $\x$. 
\icristian{De nuevo, necesitamos que $\beta_i(\x)$ mencione todas las variables?}
Let $\alpha_i(\x) = \theta_i(\x)\wedge\beta_i(\x).$

%% CLAIM CLAIM CLAIM CLAIM CLAIM CLAIM CLAIM CLAIM CLAIM CLAIM CLAIM CLAIM CLAIM CLAIM CLAIM CLAIM CLAIM CLAIM
%% CLAIM CLAIM CLAIM CLAIM CLAIM CLAIM CLAIM CLAIM CLAIM CLAIM CLAIM CLAIM CLAIM CLAIM CLAIM CLAIM CLAIM CLAIM

\begin{claim} \label{alpha}
Let $\A\in\Truc$ and $i\in\{1,\ldots,k\}$. For every assignment $\s$ to $\x$ such that $\A\models\alpha_i(\s)$, it holds that $f_{\varphi_i(\s,\X)}(\A) > 0.$
\end{claim}
\icristian{Esto lo colocaría como Lema ya que no estas afirmando nada.}
\begin{proof}
Let $\s = (\s_1,\ldots,\s_{n_i},\t)$ such that $\A\models\alpha_i(\s)$, and let $\P = (\P_1,\ldots,\P_r)$ where $P_i = \bigcup_{j\in[1,n_i]:\:\lambda(j)=i}\{s_i\}$. We will show that $\A\models\varphi_i(\s,\P)$. By contradiction, suppose that $\A\not\models\exists\x\,\varphi_i(\x,\P)$. That is, there is no assignment $\e$ to $\x$ such that $\A\models\varphi(\e,\P).$ Following the same proof as in case (a) of Lemma \ref{first}, we conclude that $\varphi_i(\x,\P)$ is inconsistent. However, as we mentioned previously, all of such disjuncts have been eliminated, which leads to a contradiction.
\end{proof}

Our plan now is to exclude the lexicographically smallest assignment $\P$ such that $\A\models\exists\x\:\varphi_1(\x,\P)$, and if there is no such $\P$, exclude the lexicographically smallest $\Q$ such that $\A\models\exists\x\:\varphi_2(\x,\Q)$, and so on. As we already know how to exclude that assignment in the first disjunct, we will now deal with the next disjuncts. 
\icristian{Acá podriamos colocar la parte de la demostración que trata con el caso de una conjunción}
Similarly to the first part of the proof, for each $i\in\{1,\ldots,k\}$ let $m_i = \sum_{j = 1}^{n_i} a_{\lambda_i(j)}$ and let
\begin{multline*}
\alpha^i_{\min}(\u_1,\dots,\u_{n_i}) = \exists\y\Big[ \alpha_i(\u_1,\dots,\u_{n_i},\y)\wedge \\ \forall\v_1\cdots\forall\v_{n_i}\forall\w\Big(\big(\alpha_i(\v_1,\dots,\v_{n_i},\w)\wedge\bigvee_{j=1}^{n_i}(\u_j\neq\v_j)\big)\to \varphi_{m_i,<}((\u_1,\dots,\u_{n_i}),(\v_1,\dots,\v_{n_i}))\Big)\Big],
\end{multline*}
where $\u_j$ and $\v_j,$ have $a_{\lambda_i(j)}$ variables for $j\in\{1,\ldots,n_i\}$, and $\w$ has $p_i$ variables. Also, let
\begin{multline*}
\psi_i(\X) = \forall\x\:\neg\alpha_i(\x) \vee \exists\u_1\cdots\exists\u_{n_i}\bigg[\alpha^i_{\min}(\u_1,\dots,\u_{n_i}) \\ \wedge \bigg(\bigg(\bigvee_{j = 1}^{n_i}\neg X_{\lambda_i(j)}(\u_i) \bigg) \vee \bigvee_{j=1}^r \exists \v\Big( X_j(\v) \wedge \bigwedge_{\ell\in[1,n_i]: \lambda_i(\ell) = j} \v \neq \u_\ell\Big) \bigg) \bigg].
\end{multline*}
\icristian{
Es necesario decir que $\forall\x\:\neg\alpha_i(\x)$?
}
Note that $\psi_i(\X)$ excludes only the lexicographically smallest tuple of predicates $\P$ such that $\A\models\exists\x\:\varphi_i(\P,\x),$ if there is at least one. 
\icristian{
De nuevo, yo sería mas preciso con este argumento del ``lexicographically smallest tuple of predicates''
}
In other words, every assignment $\P^\prime \neq \P$ is such that $\A\models\psi_i(\P^\prime).$ Our new formula $\varphi_i^\prime(\x,\X)$ is defined as follows:
\begin{multline}
\varphi_i^\prime(\x,\X) = \varphi_i(\x,\X) \wedge \psi_1(\X) \wedge (\exists\v\:\alpha_1(\v)\vee\psi_2(\X)) \wedge \cdots \wedge \\ (\exists\v\:\alpha_1(\v)\vee\cdots\vee\exists\v\:\alpha_{i-1}(\v)\vee\psi_i(\X)).
\end{multline}
\icristian{
Yo representaría ``$(\exists\v\:\alpha_1(\v)\vee\psi_2(\X))$'' como ``$(\forall\v\:\neg \alpha_1(\v)\rightarrow \psi_2(\X))$''. Se entiende mejor que representa.
}