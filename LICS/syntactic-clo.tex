%!TEX root = main.tex

Recall that a function $f : \Sigma^* \to \mathbb{N}$ has an easy decision counterpart if $L_f = \{ x \in \Sigma^* \mid f(x) > 0 \}$ is a language in $\ptime$. As the goal of this section is to define a syntactic class of functions in $\shp$ with easy decision versions and good closure properties, we do not directly consider the semantic condition $L_f  \in \ptime$, but instead we consider a more restricted class of functions that has a simple syntactic definition. More precisely, a function $f : \Sigma^* \to \mathbb{N}$ is said to be in the complexity class $\totp$ \cite{PagourtzisZ06} if there exists a nondeterministic polynomial-time Turing Machine $M$ such that $f(x) = \tmt_M(x) - 1$ for every $x \in \Sigma^*$, where $\tmt_M(x)$ is the total number of runs of $M$ with input $x$. Notice that one is subtracted from $\tmt_M(x)$ to allow for $f(x) = 0$. Besides, notice that $\totp \subseteq \shp$ and that $f \in \totp$ implies that $L_f \in \ptime$.

The complexity class $\totp$ contains many important counting problems with easy decision counterparts, such as $\cpm$, $\ctwcnf$, $\cdnf$, $\chsat$ and $\csp$. Besides, $\totp$ has good closure properties as it is closed under sum, multiplication and subtraction by one. However, some functions in $\totp$ do not admit FPRAS under standard complexity-theoretical assumptions,\footnote{As an example consider the problem of counting the number of independent sets in a graph, and the widely believed assumption that $\np$ is not equal to the randomized complexity class $\rp$ (Randomized Polynomial-Time \cite{G77}). This counting problem is in $\totp$, and it is known that $\np = \rp$ if there exists an FPRAS for it \cite{DFJ02}.} and no natural complete problems are known for this class \cite{PagourtzisZ06}. Hence, we use the $\eqso(\fo)$-hierarchy to find restrictions of $\totp$ with good closure and approximation properties.

%The previous result shows that the classes $\QE{i}$ and $\QU{i}$ are more robust than the classes $\E{i}$ and $\U{i}$: they are closed under binary and sum quantifiers but the other not necessarily. 

It was proved in \cite{SalujaST95} that every function in $\E{1}$ admits an FPRAS. Besides, it can be proved that $\E{1} \subseteq \totp$. However, this class is not closed under sum as shown in the following proposition.
\begin{proposition}\label{prop-e1-nc}
There exist functions $f, g \in \E{1}$ such that $(f + g) \not\in \E{1}$.
\end{proposition}
To overcome this limitation, one can consider the class $\QE{1}$, which is closed by under sum by definition. In fact, the following proposition shows that the same good properties as for $\E{1}$ hold for $\QE{1}$.
\begin{proposition} \label{prop:qe0-fp-qe1-totp-fptras}
$\QE{1} \subseteq \totp$ and every function in $\QE{1}$ has an FPRAS.
\end{proposition}
Moreover, from the following theorem one can conclude that $\QE{1}$ is closed under multiplication.
\begin{theorem}\label{theo:binary-prod}
	If $\LL$ is closed under conjunction, then $\eqso(\LL)$ is closed under multiplication.
\end{theorem}
Hence, it only remains to prove that $\QE{1}$ is closed under subtraction by one. Unfortunately, it is not clear whether this property holds; in fact, we conjecture that it is not the case. Thus, we need to find an extension of $\QE{1}$ that keeps all the previous properties and is closed under subtraction by one. It is important to notice that $\shp$ is believed not to be closed under subtraction by one by some complexity-theoretical assumption,\footnote{A decision problem $L$ is in the randomized complexity class $\cspp$ if there exists a nondeterministic polynomial-time Turing Machine $M$ such that for every $x \in L$ it holds that $\tma_M(x) - \tmr_M(x) = 2$, and for every $x \not\in L$ it holds that $\tma_M(x) = \tmr_M(x)$ \cite{OH93,FFK94}. It is believed that $\np \not\subseteq \cspp$, as there is no evidence that a Turing Machine with the property just described exists for the propositional satisfiability problem. However, if $\shp$ is closed under subtraction by one, then it holds that $\np \subseteq \cspp$ \cite{OH93}.} so the following proposition rules out any logic that extends $\Pi_1$.
\begin{proposition}
If $\Pi_1 \subseteq \LL$ and $\eqso(\LL)$ is closed under subtraction by one, then $\shp$ is closed under subtraction by one. 
\end{proposition}
Therefore, the desired extension has to be achieved by allowing some local extensions to $\Sigma_1$. More precisely, we define $\logex{1}$ as $\Sigma_1$ but allowing atomic formulas over a relational signature $\R$ to be of the form either $u = v$ or $X(\bar u)$, where $X$ is a second-order variable, or $\varphi(\bar u)$, where $\varphi(\bar u)$ is a first-order formula over $\R$ (in particular, it does not mentioned any second-order variable). With this extension we have that:
\begin{theorem}\label{sigmafo-minusone}
The class $\eqso(\logex{1})$ is closed under sum, product and subtraction by one. Moreover, $\eqso(\logex{1}) \subseteq \totp$ and every function in $\eqso(\logex{1})$ has an FPRAS.
\end{theorem}

A natural question at this point is whether the property of being closed under subtraction by one could be generalized to proper subtraction. More precisely, a function complexity class $\CC$ is said to be closed under subtraction if for every $f,g \in \CC$, it holds that $(f \dotdiv g) \in \CC$, where $(f \dotdiv g)(x)$ is defined as $f(x) - g(x)$ if $f(x) \geq g(x)$, and as $0$ otherwise. The following theorem shows that such generalization does not work for any of the function complexity classes considered in this section.
\begin{theorem} \label{sub-pnp}
If any of the classes $\E{1}$, $\QE{1}$ or $\eqso(\logex{1})$ is closed under subtraction, then $\ptime = \np$.
\end{theorem}

\marcelo{La version anterior de este teorema decia lo siguiente: If $\eqso(\loge{i})$ or $\eqso(\logu{i})$ is closed under subtraction for $i > 0$, then $\ptime = \np$. La razon para considerar esta version mas general era un comentario de Cristian que decia que el resultado de Martin en el apendice se generaliza trivialmente para todas las clases ya que todas contienen la clase $\eqso(\loge{0})$. Me parece que esto es incorrecto ya que tambien se necesita que cada funcion en la clase tenga un problema de decision asociado en $\ptime$, lo que no es cierto para $\eqso(\logu{1})$ y las clases de mas arriba. Estas clases no deberian ser cerradas bajo resta pero por una razon distinta (por la misma razon por la que se cree que $\shp$ no es cerrado bajo resta), pero esto no me parece que valga la pena mencionarlo.}


%
%The next question is whether the hierarchy is closed under subtraction. Formally, for any pair of functions $f,g$, we define $f - g$ as the function such that $(f - g)(\A) = f(\A)-g(\A)$ whenever $f(\A)>g(\A)$ and $0$ otherwise.
%As the next result shows, all classes in the $\eqso$-hierarchy is not closed under subtraction unless ${\sc P} = {\sc NP}$
%\begin{theorem} \label{sub-pnp}
%If $\eqso(\loge{i})$ or $\eqso(\logu{i})$ is closed under subtraction for $i > 0$, then {\sc P} = {\sc NP}.
%\end{theorem}
%\cristian{Martin, el resultado que tienes en el apendice se generaliza trivialmente para todas las clases ya que todas contienen la clase $\eqso(\loge{0})$.}


%Now, we study the complexity classes describe by this hierarchies. As the following result shows, $\eqso(\loge{0})$ defines only tractable counting functions and $\eqso(\loge{1})$ intractable counting functions but with an tractable decision problems. 
%\begin{proposition} \label{prop:qe0-fp-qe1-totp-fptras}
%All functions defined in $\eqso(\loge{0})$ and $\eqso(\loge{1})$ can be computed in $\fp$ and $\totp$, respectively. Furthermore, every function defined in $\eqso(\loge{1})$ has a FPTRAS.
%\end{proposition}
%Therefore, in terms of counting complexity, the $\eqso$-hierarchy behaves exactly the same as the $\#\fo$-hierarchy.

%The next step is to study the closure properties of $\eqso$-hierarchy. 
%An advantage of the $\eqso$-hierarchy is that, by its language syntax, all the classes are closed under addition and first and second order sum.
%So, the first question is whether the multiplicative operators in $\qso$ can be defined in $\eqso(\LL)$. As the following result shows, if $\LL$ is closed under conjunction, then the binary product can be defined in  $\eqso(\LL)$.
%\begin{theorem}\label{theo:binary-prod}
%	If $\LL$ is closed under conjunction, then binary product can be defined in $\eqso(\LL)$.
%\end{theorem}


%By the previous result, we know that functions in the $\eqso$ hierarchy are unlikely to be closed under subtraction. Then, a natural restriction to this question is to ask whether these classes are closed under subtraction by one, namely, if $\CC$ is a class of functions and $f \in \CC$, is $f-1 \in \CC$ where $1$ is the constant function that outputs $1$ for every structure. 
%We do not know $\E{1}$ is closed under subtraction by one. However, if we extend $\logex{1}$ with $\fo$ predicates we can show that this new fragment is closed under subtraction by one.
%\begin{theorem} \label{sigmafo-minusone}
%	$\eqso(\logex{1})$ is closed under substraction by one.
%\end{theorem}

