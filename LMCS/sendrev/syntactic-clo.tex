% !TeX root = main.tex

We use the \emph{$\eqso(\fo)$-hierarchy} to define syntactic classes of functions with good algorithmic and closure properties.  
But before doing this, we introduce a more strict notion of counting problem with easy decision version.
Recall that a function $f\colon\Sigma^* \to \mathbb{N}$ has an easy decision counterpart if $L_f = \{ x \in \Sigma^* \mid f(x) > 0 \}$ is a language in $\ptime$. As the goal of this section is to define a syntactic class of functions in $\shp$ with easy decision versions and good closure properties, we do not directly consider the semantic condition $L_f  \in \ptime$, but instead we consider a more restricted syntactic condition. More precisely, a function $f\colon\Sigma^* \to \mathbb{N}$ is said to be in the complexity class $\totp$~\cite{PagourtzisZ06} if there exists a  polynomial-time NTM $M$ such that $f(x) = \tmt_M(x) - 1$ for every $x \in \Sigma^*$, where $\tmt_M(x)$ is the total number of runs of $M$ with input $x$. Notice that one is subtracted from $\tmt_M(x)$ to allow for $f(x) = 0$. Besides, notice that $\totp \subseteq \shp$ and that $f \in \totp$ implies that $L_f \in \ptime$. 

The complexity class $\totp$ contains many important counting problems with easy decision counterparts, such as $\cpm$, $\cdnf$, and $\chsat$ among others~\cite{PagourtzisZ06}. Besides, $\totp$ has good closure properties as it is closed under sum, multiplication and subtraction by one. However, some functions in $\totp$ do not admit FPRAS under standard complexity-theoretical assumptions\footnote{As an example consider the problem of counting the number of independent sets in a graph, and the widely believed assumption that $\np$ is not equal to the randomized complexity class $\rp$ (Randomized Polynomial-Time \cite{G77}). This counting problem is in $\totp$, and it is known that $\np = \rp$ if there exists an FPRAS for it \cite{DFJ02}.}, and no natural complete problems are known for this class \cite{PagourtzisZ06}. Hence, we use the $\eqso(\fo)$-hierarchy to find restrictions of $\totp$ with good approximation and closure properties.

It was proved in \cite{SalujaST95} that every function in $\E{1}$ admits an FPRAS. Besides, it can be proved that $\E{1} \subseteq \totp$. 
However, this class is not closed under sum, so it is not robust under the basic closure properties we are looking for. 
\begin{prop}\label{prop-e1-nc}
There exist functions $f, g \in \E{1}$ such that $(f + g) \not\in \E{1}$.
\end{prop}
\proof
\input{proof-prop-e1-nc}
\qed
To overcome this limitation, one can consider the class $\QE{1}$, which is closed under sum by definition. In fact, the following proposition shows that the same good properties as for $\E{1}$ hold for $\QE{1}$, together with the fact that it is closed under sum and multiplication.
\begin{prop} \label{prop:qe0-fp-qe1-totp-fptras}
$\QE{1} \subseteq \totp$ and every function in $\QE{1}$ has an FPRAS. Moreover, $\QE{1}$ is closed under sum and multiplication.
\end{prop}
\proof
\input{proof-qe0-fp-qe1-totp-fptras}
\qed
Hence, it only remains to prove that $\QE{1}$ is closed under subtraction by one. Unfortunately, it is not clear whether this property holds; in fact, we conjecture that it is not the case. Thus, we need to find an extension of $\QE{1}$ that keeps all the previous properties and is closed under subtraction by one. It is important to notice that $\shp$ is believed not to be closed under subtraction by one due to some complexity-theoretical assumption\footnote{A decision problem $L$ is in the randomized complexity class $\cspp$ if there exists a polynomial-time NTM $M$ such that for every $x \in L$ it holds that $\tma_M(x) - \tmr_M(x) = 2$, and for every $x \not\in L$ it holds that $\tma_M(x) = \tmr_M(x)$ \cite{OH93,FFK94}. It is believed that $\np \not\subseteq \cspp$.
However, if $\shp$ is closed under subtraction by one, then it holds that $\np \subseteq \cspp$ \cite{OH93}.}. So, the following proposition rules out any logic that extends $\Pi_1$ as a possible extension of~$\QE{1}$ with the desired closure property.
\begin{prop} \label{pi-minusone}
If $\Pi_1 \subseteq \LL \subseteq \fo$ and $\eqso(\LL)$ is closed under subtraction by one, then $\shp$ is closed under subtraction by~one. 
\end{prop}
\proof
\input{proof-pi-minusone}
\qed
Therefore, the desired extension has to be achieved by allowing some local extensions to~$\Sigma_1$. To this end, we define $\logex{1}$ as $\Sigma_1$ but allowing atomic formulae over a signature~$\R$ to be of the form either $u = v$ or $X(\bar u)$, where $X$ is a second-order variable, or $\varphi(\bar u)$, where $\varphi(\bar u)$ is a first-order formula over $\R$ (in particular, it does not mention any second-order variable). With this extension we obtain a class with the desired properties.
\begin{thm}\label{sigmafo-minusone}
The class $\eqso(\logex{1})$ is closed under sum, multiplication and subtraction by one. Moreover, $\eqso(\logex{1}) \subseteq \totp$ and every function in $\eqso(\logex{1})$ has an FPRAS.
\end{thm}
\begin{leftbar}
\proof
\input{proof-sigmafo-minusone}
\qed
\end{leftbar}
The proof that $\eqso(\logex{1})$ is closed under subtraction by one is the most involved of the paper. We think the main technique used in this proof, which is based on considering some witnesses of logarithmic size, is of independent interest.
\martin{Esta correcci\'on se me fue en collera}
